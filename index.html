<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kintra — AI for Property Marketing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Kintra helps real estate teams respond faster, structure conversations, and book more viewings." />

  <link rel="icon" href="img/logo.png.png" />
  <meta property="og:title" content="Kintra — AI for Property Marketing" />
  <meta property="og:description" content="Respond faster, structure conversations, and book more viewings — across WhatsApp and web." />
  <meta property="og:image" content="https://founder-jpg.github.io/kintra-pilot/img/cover.jpg" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Kintra — AI for Property Marketing" />
  <meta name="twitter:description" content="Respond faster, structure conversations, and book more viewings — across WhatsApp and web." />
  <meta name="twitter:image" content="https://founder-jpg.github.io/kintra-pilot/img/cover.jpg" />
  <link rel="preload" as="image" href="img/cover.jpg">

  <style>
    :root{ --bg:#0b1215; --fg:#f8fafc; --muted:#cbd5e1; --brand:#10B981; --ink:#06241F; --card:#0f1a1e; --card2:#0d171a; --ring:#1f2937; }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%}
    body{font-family:Arial,Helvetica,sans-serif;color:var(--fg);background:linear-gradient(180deg,#0b1215 0%,#0e171b 100%)}
    a{color:var(--brand);text-decoration:none} a:hover{text-decoration:underline}
    .container{max-width:1080px;margin:0 auto;padding:28px 20px}

    .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:110px;height:auto;display:block}
    .brand-name{font-size:1.2rem;color:var(--muted);letter-spacing:.04em}
    .lang{display:flex;gap:8px;align-items:center}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid var(--ring);color:#cbd5e1;cursor:pointer}
    .pill.active{background:var(--brand);color:var(--ink);border-color:transparent}

    .hero{display:grid;grid-template-columns:1.1fr .9fr;gap:28px;align-items:center}
    @media (max-width:900px){.hero{grid-template-columns:1fr}}
    .hero-copy h1{font-size:clamp(2rem,4.8vw,3.2rem);margin:.2em 0 .15em;line-height:1.08}
    .hero-copy p{color:var(--muted);font-size:clamp(1rem,2.2vw,1.25rem);margin:.4em 0 1em}
    .cta-row{display:flex;flex-wrap:wrap;gap:12px;margin-top:.6rem}
    .btn{display:inline-block;padding:12px 18px;border-radius:12px;font-weight:700;transition:.18s all ease;border:2px solid transparent}
    .btn-primary{background:var(--brand);color:var(--ink)} .btn-primary:hover{filter:brightness(1.05)}
    .btn-secondary{background:transparent;color:var(--brand);border-color:var(--brand)} .btn-secondary:hover{background:rgba(16,185,129,.08)}
    .hero-art{position:relative;border-radius:20px;overflow:hidden;background:url('img/cover.jpg') center/cover no-repeat;min-height:320px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .hero-scrim{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.55))}

    .features{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:28px}
    @media (max-width:900px){.features{grid-template-columns:1fr}}
    .feat{background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);border:1px solid var(--ring);border-radius:16px;padding:16px 18px}
    .feat b{display:block;margin-bottom:6px}
    .feat p{margin:0;color:var(--muted);font-size:.98rem;line-height:1.45}

    .demo{margin-top:26px;background:linear-gradient(180deg,#0e1920 0%,#0b1418 100%);border:1px solid var(--ring);border-radius:16px;padding:16px 16px 14px}
    .demo-toggle{display:flex;align-items:center;gap:8px;cursor:pointer;user-select:none}
    .caret{transition:transform .18s ease}
    .caret.open{transform:rotate(90deg)}
    .demo-body{display:none;margin-top:12px}
    .row{display:flex;gap:8px}
    @media (max-width:560px){.row{flex-direction:column}}
    input[type="text"], input[type="email"]{flex:1;min-width:200px;border-radius:10px;border:1px solid #24303a;background:#0b1215;color:var(--fg);padding:12px 12px;font-size:1rem;outline:none}
    .btn-test{border-radius:10px;background:#1f2937;color:#fff;padding:12px 14px;font-weight:700;border:0}
    .btn-test:hover{filter:brightness(1.05)}
    .btn-suggest{border-radius:10px;background:#0b6d53;color:#fff;padding:12px 14px;font-weight:700;border:0}
    .btn-sum{border-radius:10px;background:#0a3a58;color:#fff;padding:12px 14px;font-weight:700;border:0}
    .result{margin-top:10px;color:#d1fae5}
    .card{background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);border:1px solid var(--ring);border-radius:12px;padding:12px}
    .result h4{margin:.1em 0 .4em;font-size:1.05rem;color:#A7F3D0}
    .result .line{margin:.2em 0;color:#cde8df}
    .result .reply{margin-top:.6em;background:#0a231d;border:1px solid #124b3d;border-radius:10px;padding:10px 12px;color:#e6fffa}

    .copy-row{display:flex;gap:8px;margin-top:10px;align-items:center;flex-wrap:wrap}
    .btn-copy,.btn-wa{border-radius:10px;background:#0b6d53;color:#fff;padding:10px 12px;font-weight:700;border:0}
    .btn-wa{background:#128C7E} .btn-wa:hover{filter:brightness(1.05)}
    .toast{display:none;margin-left:6px;color:#A7F3D0;font-size:.95rem}

    .lead{margin-top:26px;background:linear-gradient(180deg,#0e1920 0%,#0b1418 100%);border:1px solid var(--ring);border-radius:16px;padding:18px 18px 16px}
    .lead h3{margin:.1em 0 .6em;font-size:1.35rem}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    label{font-size:.9rem;color:#9fb0bf}
    textarea{width:100%;border-radius:10px;border:1px solid #24303a;background:#0b1215;color:var(--fg);padding:12px;font-size:1rem;outline:none;min-height:96px;resize:vertical}
    .row-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .note{color:#93a3b3;font-size:.9rem}
    .ok{color:#A7F3D0;font-size:.95rem;margin-top:8px;display:none}
    .err{color:#fecaca;font-size:.95rem;margin-top:8px;display:none}

    .proof{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:26px}
    @media (max-width:900px){.proof{grid-template-columns:1fr}}
    .quote{background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);border:1px solid var(--ring);border-radius:16px;padding:16px 18px;color:#e5e7eb}
    .quote i{color:#A7F3D0}
    .quote .at{color:#9fb0bf;font-size:.95rem;margin-top:6px;display:block}

    footer{margin-top:40px;padding:26px 0;color:#93a3b3;font-size:.95rem;border-top:1px dashed #1f2a33}

    /* Modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:50}
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,.55)}
    .modal-card{position:relative;max-width:520px;width:92%;background:#091112;border:1px solid #163136;border-radius:16px;padding:16px;box-shadow:0 12px 30px rgba(0,0,0,.5)}
    .modal-h{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .modal-h h4{margin:0;font-size:1.05rem;color:#A7F3D0}
    .x{cursor:pointer;border:1px solid #17343b;border-radius:8px;padding:4px 8px;color:#9fb0bf}
    .wa-chat{background:#0a1414;border:1px solid #113033;border-radius:12px;padding:12px;max-height:60vh;overflow:auto}
    .bubble{max-width:82%;padding:10px 12px;border-radius:12px;margin:8px 0;line-height:1.35}
    .me{margin-left:auto;background:#005C4B;color:#e7fffa;border-top-right-radius:4px}
    .them{margin-right:auto;background:#202c33;color:#e5e7eb;border-top-left-radius:4px}
    .meta{font-size:.8rem;color:#9fb0bf;margin-top:2px}
  </style>

  <script defer src="https://static.cloudflareinsights.com/beacon.min.js"
    data-cf-beacon='{"token": "00000000000000000000000000000000"}'></script>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <img src="img/logo.png.png" alt="Kintra logo" />
        <div class="brand-name" data-i18n="brandName">Kintra</div>
      </div>
      <div class="lang">
        <span class="pill active" id="langEn">EN</span>
        <span class="pill" id="langIt">IT</span>
      </div>
    </div>

    <section class="hero">
      <div class="hero-copy">
        <h1 data-i18n="heroH1">From listing to leads, faster.</h1>
        <p data-i18n="heroP">Kintra helps real estate teams respond faster, structure conversations, and book more viewings — across WhatsApp and web.</p>
        <div class="cta-row">
          <a class="btn btn-primary" href="#lead" data-i18n="ctaPrimary">Request Pilot Access</a>
          <a class="btn btn-secondary" href="deck.html" target="_blank" data-i18n="ctaDeck">View Live Deck</a>
          <a class="btn btn-secondary" href="deck/Kintra_PilotDeck_v1.pdf" target="_blank" download data-i18n="ctaPDF">View Deck PDF</a>
        </div>

        <div class="demo" id="demo">
          <div class="demo-toggle" id="demoToggle" aria-controls="demoBody" aria-expanded="false">
            <svg class="caret" id="caret" width="12" height="12" viewBox="0 0 24 24" fill="none">
              <path d="M8 5l8 7-8 7" stroke="#A7F3D0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <b data-i18n="demoTitle">Try a 10-second demo</b>
            <span style="color:#94a3b8;" data-i18n="demoOpt">(optional)</span>
          </div>
          <div class="demo-body" id="demoBody">
            <div class="row" style="margin-top:10px;">
              <input id="q" type="text" data-i18n-placeholder="demoPlaceholder" placeholder="Type a buyer message… (e.g., 'hello please')" />
              <button class="btn-test" id="testBtn" type="button" data-i18n="demoRun">Run</button>
              <button class="btn-suggest" id="suggestBtn" type="button">AI Suggest Reply</button>
              <button class="btn-sum" id="sumBtn" type="button">Generate Summary</button>
            </div>

            <!-- Human-friendly result -->
            <div class="result" id="result"></div>

            <div class="copy-row">
              <button class="btn-copy" id="copyBtn">Copy reply</button>
              <button class="btn-wa" id="waBtn">Send to WhatsApp (Preview)</button>
              <span class="toast" id="toast">Copied ✓</span>
            </div>
          </div>
        </div>
      </div>

      <div class="hero-art" role="img" aria-label="Modern apartment interior">
        <div class="hero-scrim"></div>
      </div>
    </section>

    <section class="features">
      <div class="feat"><b data-i18n="f1H">Faster responses</b><p data-i18n="f1P">Structure and translate replies in seconds — fewer delays, more booked viewings.</p></div>
      <div class="feat"><b data-i18n="f2H">Nothing slips</b><p data-i18n="f2P">Summaries + next-steps ensure every lead is nurtured, across WhatsApp and web.</p></div>
      <div class="feat"><b data-i18n="f3H">Pilot in 2–4 weeks</b><p data-i18n="f3P">Lightweight setup, run with 3–5 live interactions, measure minutes saved.</p></div>
    </section>

    <section class="lead" id="lead">
      <h3 data-i18n="leadH">Request Pilot Access</h3>
      <div class="grid">
        <div>
          <label for="name" data-i18n="labelName">Name</label>
          <input id="name" type="text" data-i18n-placeholder="namePH" placeholder="Alex Rossi" />
        </div>
        <div>
          <label for="email" data-i18n="labelEmail">Work email</label>
          <input id="email" type="email" data-i18n-placeholder="emailPH" placeholder="alex.rossi@agency.it" />
        </div>
      </div>
      <div style="margin-top:10px">
        <label for="msg" data-i18n="labelMsg">What’s your current workflow? (optional)</label>
        <textarea id="msg" data-i18n-placeholder="msgPH" placeholder="We handle inbound on WhatsApp + email, want faster replies…"></textarea>
        <input id="website" type="text" name="website" tabindex="-1" autocomplete="off" style="position:absolute;left:-9999px;opacity:0;height:0;width:0" aria-hidden="true" />
      </div>
      <div class="row-actions">
        <button id="send" class="btn btn-primary" type="button" data-i18n="leadBtn">Join Pilot Waitlist</button>
        <a class="btn btn-secondary" href="mailto:pilot@kintra.xyz?subject=Kintra Pilot Access&body=Hi, we’d like to join the pilot. Our workflow: ..." target="_blank" data-i18n="leadAlt">Or email us</a>
      </div>
      <div class="note" data-i18n="leadNote">No spam. Limited early access.</div>
      <div class="ok" id="ok" data-i18n="leadOk">Thanks — we’ll be in touch within 24 hours.</div>
      <div class="err" id="err">Sorry, something went wrong. You can email <a href="mailto:pilot@kintra.xyz">pilot@kintra.xyz</a>.</div>
    </section>

    <section class="proof">
      <div class="quote"><i data-i18n="q1">“Kintra saved our agents real time. Replies are faster, and follow-ups don’t slip.”</i><span class="at" data-i18n="q1at">— Early partner (pilot)</span></div>
      <div class="quote"><i data-i18n="q2">“Setup was easy. We plugged in WhatsApp + web and started seeing value the same week.”</i><span class="at" data-i18n="q2at">— Agency lead (pilot)</span></div>
    </section>

    <footer>© <span id="yr"></span> Kintra. <span data-i18n="footer">Pilot inquiries:</span> <a href="mailto:pilot@kintra.xyz">pilot@kintra.xyz</a></footer>
  </div>

  <!-- WhatsApp Preview Modal -->
  <div class="modal" id="modal">
    <div class="overlay" id="ov"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="mh">
      <div class="modal-h">
        <h4 id="mh">WhatsApp Preview</h4>
        <span class="x" id="xBtn">Close</span>
      </div>
      <div class="wa-chat" id="chat"></div>
    </div>
  </div>

  <script>
    document.getElementById('yr').textContent = new Date().getFullYear();

    const I18N = {
      en: {
        brandName:'Kintra',
        heroH1:'From listing to leads, faster.',
        heroP:'Kintra helps real estate teams respond faster, structure conversations, and book more viewings — across WhatsApp and web.',
        ctaPrimary:'Request Pilot Access', ctaDeck:'View Live Deck', ctaPDF:'View Deck PDF',
        demoTitle:'Try a 10-second demo', demoOpt:'(optional)', demoPlaceholder:"Type a buyer message… (e.g., 'hello please')", demoRun:'Run',
        f1H:'Faster responses', f1P:'Structure and translate replies in seconds — fewer delays, more booked viewings.',
        f2H:'Nothing slips', f2P:'Summaries + next-steps ensure every lead is nurtured, across WhatsApp and web.',
        f3H:'Pilot in 2–4 weeks', f3P:'Lightweight setup, run with 3–5 live interactions, measure minutes saved.',
        leadH:'Request Pilot Access', labelName:'Name', labelEmail:'Work email', labelMsg:'What’s your current workflow? (optional)',
        leadBtn:'Join Pilot Waitlist', leadAlt:'Or email us', leadNote:'No spam. Limited early access.', leadOk:'Thanks — we’ll be in touch within 24 hours.',
        q1:'“Kintra saved our agents real time. Replies are faster, and follow-ups don’t slip.”', q1at:'— Early partner (pilot)',
        q2:'“Setup was easy. We plugged in WhatsApp + web and started seeing value the same week.”', q2at:'— Agency lead (pilot)',
        footer:'Pilot inquiries:',
        labSummary:'Summary', labNext:'Next step', labReply:'Reply',
        running:'Running…', err:'Error: ', copied:'Copied ✓',
        namePH:'Alex Rossi', emailPH:'alex.rossi@agency.it', msgPH:'We handle inbound on WhatsApp + email, want faster replies…',
        waPreview:'Send to WhatsApp (Preview)', waClose:'Close', waYou:'Buyer', waAgent:'Kintra'
      },
      it: {
        brandName:'Kintra',
        heroH1:'Dall’annuncio ai lead, più velocemente.',
        heroP:'Kintra aiuta i team immobiliari a rispondere più in fretta, strutturare le conversazioni e fissare più visite — su WhatsApp e web.',
        ctaPrimary:'Richiedi accesso al pilot', ctaDeck:'Guarda il deck', ctaPDF:'Scarica il PDF',
        demoTitle:'Prova demo da 10 secondi', demoOpt:'(opzionale)', demoPlaceholder:"Scrivi un messaggio dell’acquirente… (es. 'hello please')", demoRun:'Esegui',
        f1H:'Risposte più rapide', f1P:'Struttura e traduci le risposte in pochi secondi — meno attese, più visite fissate.',
        f2H:'Nulla sfugge', f2P:'Riepiloghi + prossime azioni assicurano che ogni lead sia seguito, su WhatsApp e web.',
        f3H:'Pilot in 2–4 settimane', f3P:'Setup leggero, 3–5 interazioni reali, misura i minuti risparmiati.',
        leadH:'Richiedi accesso al pilot', labelName:'Nome', labelEmail:'Email di lavoro', labelMsg:'Qual è il tuo flusso attuale? (opzionale)',
        leadBtn:'Unisciti alla lista d’attesa', leadAlt:'Oppure scrivici', leadNote:'Niente spam. Accesso anticipato limitato.', leadOk:'Grazie — ti ricontatteremo entro 24 ore.',
        q1:'“Kintra ha fatto risparmiare tempo ai nostri agenti. Risposte più veloci, follow-up sempre sotto controllo.”', q1at:'— Partner iniziale (pilot)',
        q2:'“Setup semplice. Abbiamo collegato WhatsApp + web e visto valore nella stessa settimana.”', q2at:'— Responsabile agenzia (pilot)',
        footer:'Richieste per il pilot:',
        labSummary:'Riepilogo', labNext:'Prossima azione', labReply:'Risposta',
        running:'In esecuzione…', err:'Errore: ', copied:'Copiato ✓',
        namePH:'Alex Rossi', emailPH:'alex.rossi@agency.it', msgPH:'Gestiamo i messaggi in entrata su WhatsApp ed email, vogliamo risposte più rapide…',
        waPreview:'Invia su WhatsApp (Anteprima)', waClose:'Chiudi', waYou:'Acquirente', waAgent:'Kintra'
      }
    };

    function applyLang(lang) {
      const dict = I18N[lang] || I18N.en;
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (dict[key]) el.textContent = dict[key];
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (dict[key]) el.setAttribute('placeholder', dict[key]);
      });
      document.getElementById('langEn').classList.toggle('active', lang === 'en');
      document.getElementById('langIt').classList.toggle('active', lang === 'it');
      document.documentElement.lang = lang;
      localStorage.setItem('kintraLang', lang);
      document.getElementById('waBtn').textContent = dict.waPreview;
      document.getElementById('xBtn').textContent = dict.waClose;
    }

    document.getElementById('langEn').addEventListener('click', () => applyLang('en'));
    document.getElementById('langIt').addEventListener('click', () => applyLang('it'));

    const savedLang = localStorage.getItem('kintraLang');
    if (savedLang) applyLang(savedLang);
    else applyLang((navigator.language || 'en').toLowerCase().startsWith('it') ? 'it' : 'en');

    // Demo expand/collapse
    const t = document.getElementById('demoToggle');
    const b = document.getElementById('demoBody');
    const c = document.getElementById('caret');
    t.addEventListener('click', () => {
      const open = b.style.display === 'block';
      b.style.display = open ? 'none' : 'block';
      c.classList.toggle('open', !open);
      t.setAttribute('aria-expanded', String(!open));
    });

    const WORKER_BASE = 'https://kintra-api.founder-60b.workers.dev';
    const resultEl = document.getElementById('result');
    const copyBtn = document.getElementById('copyBtn');
    const waBtn = document.getElementById('waBtn');
    const toast = document.getElementById('toast');

    function currentLang(){ return document.documentElement.lang === 'it' ? 'it' : 'en'; }
    function escapeHtml(s){return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}

    let lastInput = '';
    let lastReply = '';
    let lastSummary = '';
    let lastNext = '';
    let lastLang = 'en';

    // Generic runner (helper)
    async function runEndpoint(path, body, onOk){
      const dict = I18N[currentLang()] || I18N.en;
      resultEl.innerHTML = `<div class="card">${dict.running}</div>`;
      try{
        const res = await fetch(WORKER_BASE + path, {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify(body)
        });
        const json = await res.json();
        const r = json.result || {};
        lastInput = r.input || body.text || '';
        lastReply = (r.reply && r.reply.text) ? r.reply.text : (lastReply || '');
        lastSummary = r.summary || lastSummary || '';
        lastNext = r.next_step || lastNext || '';
        lastLang = (r.reply && r.reply.language) || currentLang();
        onOk && onOk(r);
        renderResult();
      }catch(e){
        resultEl.innerHTML = `<div class="card">${(I18N[currentLang()]?.err || 'Error: ')}${e.message}</div>`;
      }
    }

    // Render friendly result card
    function renderResult(){
      const dict = I18N[currentLang()] || I18N.en;
      resultEl.innerHTML = `
        <div class="card">
          <h4>${lastLang==='it' ? 'Pronto per l’invio' : 'Ready to send'}</h4>
          <div class="line"><b>${lastLang==='it' ? 'Messaggio del cliente:' : 'Buyer message:'}</b> ${escapeHtml(lastInput || '—')}</div>
          <div class="line"><b>${dict.labSummary}:</b> ${escapeHtml(lastSummary || '—')}</div>
          <div class="line"><b>${dict.labNext}:</b> ${escapeHtml(lastNext || '—')}</div>
          <div class="reply"><b>${dict.labReply}:</b><br>${escapeHtml(lastReply || '—')}</div>
        </div>`;
      copyBtn.dataset.reply = lastReply || '';
    }

    // Buttons
    document.getElementById('testBtn').addEventListener('click', () => {
      const q = (document.getElementById('q').value || '').trim() || 'hello please';
      runEndpoint('/api/prompt', { text:q, lang: currentLang() });
    });

    document.getElementById('suggestBtn').addEventListener('click', () => {
      const q = (document.getElementById('q').value || '').trim() || 'Ciao, è disponibile domani?';
      runEndpoint('/api/suggest', { text:q, lang: currentLang() });
    });

    document.getElementById('sumBtn').addEventListener('click', () => {
      // Use lastInput if present; else current box
      const text = (lastInput || document.getElementById('q').value || '').trim() || 'Ciao, info sull’appartamento?';
      runEndpoint('/api/summarize', { text, lang: currentLang() });
    });

    // Copy reply
    copyBtn.addEventListener('click', async () => {
      const dict = I18N[currentLang()] || I18N.en;
      const text = copyBtn.dataset.reply || '';
      if (!text) return;
      try { await navigator.clipboard.writeText(text);
        toast.textContent = dict.copied; toast.style.display='inline';
        setTimeout(()=>toast.style.display='none',1400);
      } catch {}
    });

    // Lead submit (unchanged)
    const sendBtn = document.getElementById('send');
    const okEl = document.getElementById('ok');
    const errEl = document.getElementById('err');
    function validateEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }

    sendBtn.addEventListener('click', async () => {
      okEl.style.display = 'none'; errEl.style.display = 'none';
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const msg = document.getElementById('msg').value.trim();
      const website = document.getElementById('website').value.trim();

      if (!name || !validateEmail(email)) {
        errEl.textContent = (currentLang()==='it')
          ? 'Inserisci nome ed una email valida.' : 'Please enter your name and a valid work email.';
        errEl.style.display = 'block'; return;
      }

      try {
        const res = await fetch(WORKER_BASE + '/api/lead', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ name, email, message: msg, website, ts: new Date().toISOString() })
        });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const json = await res.json();
        if (json && json.ok) {
          okEl.style.display='block';
          document.getElementById('name').value='';
          document.getElementById('email').value='';
          document.getElementById('msg').value='';
          document.getElementById('website').value='';
          return;
        }
        throw new Error('Bad response');
      } catch (e) {
        const subject = encodeURIComponent('Kintra Pilot Access');
        const body = encodeURIComponent(`Name: ${name}\nEmail: ${email}\nMessage: ${msg}`);
        window.location.href = `mailto:pilot@kintra.xyz?subject=${subject}&body=${body}`;
      }
    });

    // WhatsApp Preview Modal
    const modal = document.getElementById('modal');
    const ov = document.getElementById('ov');
    const xBtn = document.getElementById('xBtn');
    const chat = document.getElementById('chat');

    function openModal(){
      const dict = I18N[currentLang()] || I18N.en;
      chat.innerHTML = `
        <div class="bubble them"><b>${dict.waYou}:</b> ${escapeHtml(lastInput || 'Ciao, è disponibile?')}</div>
        <div class="meta">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
        <div class="bubble me"><b>${dict.waAgent}:</b> ${escapeHtml(lastReply || (currentLang()==='it'
          ? 'Ciao! Possiamo fissare una visita. Le vanno bene domani alle 17:00 o mercoledì alle 10:30?'
          : 'Hi! We can arrange a viewing. Would tomorrow at 5pm or Wednesday at 10:30am work?'))}</div>
        <div class="meta">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
      `;
      modal.style.display = 'flex';
    }
    function closeModal(){ modal.style.display = 'none'; }

    waBtn.addEventListener('click', () => openModal());
    ov.addEventListener('click', () => closeModal());
    xBtn.addEventListener('click', () => closeModal());
  </script>
</body>
</html>
